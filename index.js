"use strict";require("core-js/modules/es.promise.js"),require("core-js/modules/es.json.stringify.js"),console.log("js loaded");var baseURL,webURL,userData={apiKey:"",userToken:"",meetingToken:"",meetingId:""};function init(a){let b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"production";userData.apiKey=a,"production"===b?(baseURL="https://cilix.prod.jibb.cloud",webURL="https://app.jibb.ai"):(baseURL="https://cilix.testing.jibb.cloud",webURL="https://app.testing.jibb.cloud")}function getUserTokenFromApiKey(){let a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:3600;return new Promise(function(b,c){fetch(baseURL+"/v1/auth/token?expiry="+a,{headers:{"Content-Type":"application/json",Accept:"text/plain"},method:"POST",body:JSON.stringify({api_key:userData.apiKey})}).then(function(a){a.text().then(function(a){userData.userToken=JSON.parse(a).token,b(userData.userToken)})}).catch(a=>{c(a)})})}function getUserToken(a){return new Promise(function(b,c){fetch(baseURL+"/v1/auth/token?expiry=3600",{headers:{"Content-Type":"application/json","x-jibb-id-jwt":a,Accept:"text/plain"}}).then(function(a){a.text().then(function(a){b(a)})}).catch(a=>{c(a)})})}function getMeetingToken(a,b){return new Promise(function(c,d){fetch(baseURL+"/v1/meetings/"+a+"/token/"+b+"?expiry=3600",{headers:{"x-jibb-user-jwt":userData.userToken,"Content-Type":"application/x-protobuf"}}).then(function(a){a.text().then(function(a){userData.meetingToken=JSON.parse(a).token,c(userData.meetingToken)})}).catch(a=>{d(a)})})}function getCameraList(a){return new Promise(function(b,c){fetch(baseURL+"/api/eventbus/"+a+"/camera",{headers:{"x-jibb-user-jwt":userData.userToken,Accept:"text/plain","Content-Type":"application/x-protobuf"}}).then(function(a){a.text().then(function(a){b(JSON.parse(a).items)})}).catch(a=>{c(a)})})}function getMeetingList(){return new Promise(function(a,b){fetch(baseURL+"/v1/meetings",{headers:{"x-jibb-user-jwt":userData.userToken,Accept:"text/plain"}}).then(function(b){b.text().then(function(b){a(JSON.parse(b).meetings)})}).catch(a=>{b(a)})})}function createShareMeeting(a,b){return new Promise(function(c,d){fetch(baseURL+"/api/meetings/"+a+"/share/"+b,{method:"POST",headers:{"x-jibb-user-jwt":userData.userToken,Accept:"text/plain","Content-Type":"application/json"}}).then(function(a){a.text().then(function(a){c(a)})}).catch(a=>{d(a)})})}function createMeeting(a){return new Promise(function(b,c){fetch(baseURL+"/v1/meetings",{method:"post",body:JSON.stringify({type:"COLLABORATION",title:a}),headers:{"x-jibb-user-jwt":userData.userToken,Accept:"text/plain","Content-Type":"application/json"}}).then(function(a){a.text().then(function(a){b(JSON.parse(a))})}).catch(a=>{c(a)})})}function startStream(a,b,c,d){let e=4<arguments.length&&arguments[4]!==void 0?arguments[4]:"WEBAPP";return new Promise(function(f,g){fetch(baseURL+"/api/eventbus",{method:"post",body:JSON.stringify({startInputStreamRequest:{clientType:e,surfaceType:c,meetingId:a,meetingToken:b,inputSource:{id:d}}}),headers:{"x-jibb-user-jwt":userData.userToken,Accept:"text/plain","Content-Type":"application/json"}}).then(function(a){a.text().then(function(a){f(a)})}).catch(a=>{g(a)})})}function stopStream(){let a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"WEBAPP";return new Promise(function(b,c){fetch(baseURL+"/api/eventbus",{method:"post",body:JSON.stringify({stopInputStreamRequest:{clientType:a}}),headers:{"x-jibb-user-jwt":userData.userToken,Accept:"text/plain","Content-Type":"application/json"}}).then(function(a){a.text().then(function(a){b(a)})}).catch(a=>{c(a)})})}function generateMeetingLink(){return new Promise(function(a,b){getUserTokenFromApiKey().then(async function(){var a=await getMeetingList();if(a.length)return userData.meetingId=a[0].id,userData.meetingId;var b=await createMeeting("");return userData.meetingId=b.id,userData.meetingId}).then(function(){return getMeetingToken(userData.meetingId,"write")}).then(function(b){userData.meetingToken=b;let c=webURL+"/route/remote/"+userData.meetingId+"?user_token="+userData.userToken;a(c)}).catch(function(a){console.log(a),b(a)})})}function autoStartMeeting(){return getUserTokenFromApiKey().then(function(){return getCameraList("webapp")}).then(function(a){return a.length?startStream(userData.meetingId,userData.meetingToken,"PAPER",a[0].id):Promise.reject("No Camera Access")})}function autoStopMeeting(){return getUserTokenFromApiKey().then(function(){return stopStream()})}async function test(){var a;a=await getUserTokenFromApiKey("https://cilix.testing.jibb.cloud",apiKey),console.log(a)}